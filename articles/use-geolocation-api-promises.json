{"title":"How to use Geolocation API with Promises","slug":"use-geolocation-api-promises","html":"<p><a href=\"https://whatwebcando.today/geolocation.html\">Geolocation API</a> is definitely one of the best known device integration APIs we have on the web, both thanks its usefulness as well as its age. It lets the apps gain access to the user&#39;s location, expressed as geo-coordinates and subscribe to its changes. The possible usages range from location-based content filtering through mapping services to city games.</p>\n<p><img src=\"/articleimgs/beige-map.pexels.jpg\" alt=\"How to use Geolocation API with Promises\"></p>\n<p>The first specs were created <a href=\"https://www.w3.org/TR/2008/WD-geolocation-API-20081222/#geolocation_interface\">around 2008</a> and implemented by the browsers as early as 2009. The support ranges back to Internet Explorer 9 and Safari 5. Most of the API remains unchanged since then, and it can be felt nowadays, as its design even predates <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises\">Promises</a> – the only way APIs on the Web platform handle asynchronicity these days. Geolocation API uses almost forgotten pattern of callbacks to handle its asynchronicity – so for developers used to Promise chains it might not be obvious how to make it work together with Promise-based APIs.</p>\n<p>Fortunately, converting callback-based Geolocation API into Promise-based one requires only a simple wrapper, here in TypeScript version for type safety:</p>\n<pre><code>function getPosition(options?: PositionOptions): Promise&lt;Position&gt; {\n    return new Promise((resolve, reject) =&gt; \n        navigator.geolocation.getCurrentPosition(resolve, reject, options)\n    );\n}</code></pre><p>Now we can use this version of Geolocation API with Promise chains. Its only parameter is now the optional <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/PositionOptions\"><code>options</code> parameter</a>, callbacks are replaced by Promise resolved or rejected value:</p>\n<pre><code>getPosition(options)\n  .then((position) =&gt; {\n    console.log(position);\n  })\n  .catch((err) =&gt; {\n    console.error(err.message);\n  });</code></pre><p>It can also be used with <code>async</code>/<code>await</code>, as it&#39;s only a syntactic sugar on top of Promises:</p>\n<pre><code>try {\n    const position = await getPosition(options);\n    console.log(position);\n} catch (err) {\n    console.error(err.message);\n}</code></pre><p>This async block is equivalent to the pure Promise version above.</p>\n<p>Apparently, this simple Promise-based wrapper for Geolocation API was also released as at least <a href=\"https://www.npmjs.com/search?q=geolocation%20promise\">several NPM packages</a>, if this is the way you prefer to import the code, although these three lines don&#39;t seem to justify adding next dependency to our project.</p>\n","image":"/articleimgs/beige-map.pexels.jpg","tags":["Geolocation"],"description":"Geolocation API is definitely one of the best known device integration APIs we have on the web, both thanks its usefulness as well as its age. It lets the apps gain access to the user's location, expressed as geo-coordinates and subscribe to its changes. The possible usages range from location-based content filtering through mapping services to city games.","author":"<p><a href=\"https://adambar.pl\">Adam Bar</a></p>\n","weight":1,"source":"wwcd"}